# PCA9685 Go Driver

–î—Ä–∞–π–≤–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è 16-–∫–∞–Ω–∞–ª—å–Ω—ã–º PWM-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º PCA9685 –Ω–∞ —è–∑—ã–∫–µ Go. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å RGB —Å–≤–µ—Ç–æ–¥–∏–æ–¥–∞–º–∏, –Ω–∞—Å–æ—Å–∞–º–∏ –∏ –¥—Ä—É–≥–∏–º–∏ PWM-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üîß –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 16 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö PWM-–∫–∞–Ω–∞–ª–æ–≤
- üåà –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ RGB —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–≤
- üíß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å–æ—Å–∞–º–∏ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —Å–∫–æ—Ä–æ—Å—Ç–∏
- üîå –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö I¬≤C –±–∏–±–ª–∏–æ—Ç–µ–∫
- üß™ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —ç–º—É–ª—è—Ç–æ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- üìù –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- üîÑ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –¥–ª—è –æ—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–π
- üîí –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
go get github.com/snaart/go-pca9685
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```go
package main

import (
    "context"
    "github.com/snaart/go-pca9685/pkg/pca9685"
    "github.com/d2r2/go-i2c"
)

func main() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è I2C
    i2c, err := i2c.NewI2C(0x40, 1)
    if err != nil {
        panic(err)
    }
    defer i2c.Close()

    // –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–∞–ø—Ç–µ—Ä–∞
    adapter := pca9685.NewI2CAdapterD2r2(i2c)

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
    config := pca9685.DefaultConfig()
    pca, err := pca9685.New(adapter, config)
    if err != nil {
        panic(err)
    }
    defer pca.Close()

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PWM –Ω–∞ –∫–∞–Ω–∞–ª–µ 0
    ctx := context.Background()
    err = pca.SetPWM(ctx, 0, 0, 2048)
}
```

### –†–∞–±–æ—Ç–∞ —Å RGB —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–º

```go
// –°–æ–∑–¥–∞–Ω–∏–µ RGB —Å–≤–µ—Ç–æ–¥–∏–æ–¥–∞ –Ω–∞ –∫–∞–Ω–∞–ª–∞—Ö 0, 1, 2
led, err := pca9685.NewRGBLed(pca, 0, 1, 2)
if err != nil {
    panic(err)
}

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–∞
ctx := context.Background()
err = led.SetColor(ctx, 255, 0, 0) // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å–æ—Å–æ–º

```go
// –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—Å–æ—Å–∞ –Ω–∞ –∫–∞–Ω–∞–ª–µ 3
pump, err := pca9685.NewPump(pca, 3, pca9685.WithSpeedLimits(1000, 3000))
if err != nil {
    panic(err)
}

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ 50%
ctx := context.Background()
err = pump.SetSpeed(ctx, 50)
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã/—Å—Ü–µ–Ω–∞—Ä–∏–∏: [–ü—Ä–∏–º–µ—Ä—ã](./examples/examples.md).

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –¥–ª—è –∞–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ I¬≤C –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏:

1. **I2CAdapterD2r2** - –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ d2r2/go-i2c
2. **I2CAdapterPeriph** - –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ periph.io
3. **TestI2C** - –∞–¥–∞–ø—Ç–µ—Ä-—ç–º—É–ª—è—Ç–æ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–í—Å–µ –∞–¥–∞–ø—Ç–µ—Ä—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `I2C`:

```go
type I2C interface {
    WriteReg(reg uint8, data []byte) error
    ReadReg(reg uint8, data []byte) error
    Close() error
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `I2C`. –ü—Ä–∏–º–µ—Ä:

```go
type MyI2CAdapter struct {
    dev    MyI2CDevice
    logger pca9685.Logger
}

func NewMyI2CAdapter(dev MyI2CDevice) *MyI2CAdapter {
    return &MyI2CAdapter{
        dev:    dev,
        logger: pca9685.NewDefaultLogger(pca9685.LogLevelBasic),
    }
}

func (a *MyI2CAdapter) WriteReg(reg uint8, data []byte) error {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ø–∏—Å–∏ –≤ —Ä–µ–≥–∏—Å—Ç—Ä
}

func (a *MyI2CAdapter) ReadReg(reg uint8, data []byte) error {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á—Ç–µ–Ω–∏—è –∏–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞
}

func (a *MyI2CAdapter) Close() error {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
}
```

## –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±–∫—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –¥–≤—É–º—è —É—Ä–æ–≤–Ω—è–º–∏:

- **LogLevelBasic** - —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- **LogLevelDetailed** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

–õ–æ–≥–≥–µ—Ä –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:

```go
config := pca9685.DefaultConfig()
config.LogLevel = pca9685.LogLevelDetailed
config.Logger = MyCustomLogger{} // –î–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Logger
```

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å Logger:

```go
type Logger interface {
    Basic(msg string, args ...interface{})
    Detailed(msg string, args ...interface{})
    Error(msg string, args ...interface{})
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –≠–º—É–ª—è—Ç–æ—Ä TestI2C

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `TestI2C`:

```go
// –°–æ–∑–¥–∞–Ω–∏–µ —ç–º—É–ª—è—Ç–æ—Ä–∞
adapter := pca9685.NewTestI2C()

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Å —ç–º—É–ª—è—Ç–æ—Ä–æ–º
pca, err := pca9685.New(adapter, pca9685.DefaultConfig())
```

–≠–º—É–ª—è—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≤ –ø–∞–º—è—Ç—å –∏ —ç–º—É–ª–∏—Ä—É–µ—Ç —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤.

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
go test ./... -v
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [Docs](./docs/API.md).

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

### Linux

- –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —á–µ—Ä–µ–∑ d2r2/go-i2c –∏ periph.io
- –î–æ—Å—Ç—É–ø –∫ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º—É I¬≤C

### MacOS/Windows

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–µ—Ä–µ–∑ —ç–º—É–ª—è—Ç–æ—Ä TestI2C
- –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –ö–∞–∫ –≤–Ω–µ—Å—Ç–∏ –≤–∫–ª–∞–¥ ü§ù
1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É: `git checkout -b feature/your-idea`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã: `go test -race ./...`
4. –°–¥–µ–ª–∞–π—Ç–µ –∫–æ–º–º–∏—Ç: `git commit -m 'Add awesome feature'`
5. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ—Å–µ–Ω–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π

1. –°–ª–µ–¥—É–π—Ç–µ —Å—Ç–∏–ª—é –∫–æ–¥–∞ Go
2. –î–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
3. –û–±–Ω–æ–≤–ª—è–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ PR

- –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –¢–µ—Å—Ç—ã
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è


## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ adapter_d2r2_linux.go    // –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è d2r2/go-i2c
‚îú‚îÄ‚îÄ adapter_periph_io_linux.go // –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è periph.io
‚îú‚îÄ‚îÄ adapter_testing.go       // –¢–µ—Å—Ç–æ–≤—ã–π –∞–¥–∞–ø—Ç–µ—Ä
‚îú‚îÄ‚îÄ logger.go               // –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ pca9685.go             // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
‚îú‚îÄ‚îÄ pump.go                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å–æ—Å–∞–º–∏
‚îú‚îÄ‚îÄ rgb.go                 // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RGB —Å–≤–µ—Ç–æ–¥–∏–æ–¥–∞–º–∏
‚îî‚îÄ‚îÄ pca9685_test.go       // –¢–µ—Å—Ç—ã
```

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ üîó
- [–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è PCA9685](https://www.nxp.com/docs/en/data-sheet/PCA9685.pdf)
- [Go context package](https://golang.org/pkg/context/)
- [I2C –≤ Go](https://pkg.go.dev/golang.org/x/exp/io/i2c)

## –õ–∏—Ü–µ–Ω–∑–∏—è ‚öñÔ∏è
MIT License ¬© 2024 [SNAcorp]. –°–º. [LICENSE](LICENSE).

---

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å. –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.**
